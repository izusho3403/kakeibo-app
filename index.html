<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒªï¼ˆGASç‰ˆï¼‰</header>
  <main>
    <form onsubmit="handleSubmit(event)">
      <label>æ—¥ä»˜:
        <input type="date" id="date" required>
      </label>
      <label>é …ç›®: 
        <select id="item">
          <option value="é£Ÿè²»">ğŸš é£Ÿè²»</option>
          <option value="äº¤é€šè²»">ğŸšŒ äº¤é€šè²»</option>
          <option value="å¨¯æ¥½">ğŸ® å¨¯æ¥½</option>
          <option value="çµ¦æ–™">ğŸ’° çµ¦æ–™</option>
          <option value="ãã®ä»–">âœ¨ ãã®ä»–</option>
        </select>
      </label>
      <label>é‡‘é¡:
        <input type="number" id="amount" placeholder="ä¾‹: 5000" required>
      </label>
      <label>ç¨®é¡:
        <select id="type">
          <option value="åå…¥">ğŸ“ˆ åå…¥</option>
          <option value="æ”¯å‡º">ğŸ“‰ æ”¯å‡º</option>
        </select>
      </label>
      <button type="submit">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
    </form>

    <div class="chart-container">
      <h2>ğŸ“Š é …ç›®ã”ã¨ã®é›†è¨ˆ</h2>
      <canvas id="summaryChart"></canvas>
    </div>
  </main>

  <script>
    function handleSubmit(e) {
      e.preventDefault();
      const data = {
        date: document.getElementById("date").value,
        item: document.getElementById("item").value,
        amount: document.getElementById("amount").value,
        type: document.getElementById("type").value
      };
      google.script.run.withSuccessHandler(() => {
        alert("âœ… ä¿å­˜ã—ã¾ã—ãŸï¼");
        loadSummary();
      }).saveData(data);
    }

    function loadSummary() {
      google.script.run.withSuccessHandler(summary => {
        const labels = Object.keys(summary);
        const incomeData = labels.map(l => summary[l].income);
        const expenseData = labels.map(l => summary[l].expense);

        const ctx = document.getElementById("summaryChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              { label: "åå…¥", data: incomeData, backgroundColor: "rgba(46, 204, 113, 0.7)" },
              { label: "æ”¯å‡º", data: expenseData, backgroundColor: "rgba(231, 76, 60, 0.7)" }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'top' }
            }
          }
        });
      }).getSummary();
    }

    window.onload = loadSummary;
  </script>
</body>
</html>
